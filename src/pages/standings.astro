---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Standings | MAVERICKS x SYNAPSE BGMI 2026" description="Live leaderboard and standings for SYNAPSE MAMC BGMI 2026 tournament." activePage="standings">
  <section class="leaderboard-section">
    <div class="container">
      <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
        <h1 class="page-title" style="margin:0;">Overall Standings</h1>
        <div class="live-indicator">
          <span class="live-dot"></span>
          <span>Live</span>
        </div>
      </div>

      <!-- Leading Team Banner (will be populated by JavaScript) -->
      <div id="leadingTeamBannerContainer"></div>

      <div class="filter-tabs" id="filterTabs">
        <button class="filter-btn active" data-filter="all">
          <span>Overall</span>
        </button>
        <button class="filter-btn" data-filter="day1">
          <span>Day 1</span>
        </button>
        <button class="filter-btn" data-filter="day2">
          <span>Day 2</span>
        </button>
        <button class="filter-btn" data-filter="day3">
          <span>Day 3</span>
        </button>
        <button class="filter-btn" data-filter="finals">
          <span>Finals</span>
        </button>
      </div>

      <div id="matchFilters" style="display: none; justify-content: center; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap;">
        <button class="filter-btn btn-sm" data-match="1">M1</button>
        <button class="filter-btn btn-sm" data-match="2">M2</button>
        <button class="filter-btn btn-sm" data-match="3">M3</button>
        <button class="filter-btn btn-sm" data-match="4">M4</button>
        <button class="filter-btn btn-sm" data-match="5">M5</button>
      </div>

      <div id="overallFilters" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap;">
        <button class="filter-btn btn-sm active" data-group="all">Overall</button>
        <button class="filter-btn btn-sm" data-group="A">Group A</button>
        <button class="filter-btn btn-sm" data-group="B">Group B</button>
        <button class="filter-btn btn-sm" data-group="C">Group C</button>
        <button class="filter-btn btn-sm" data-group="D">Group D</button>
        <button class="filter-btn btn-sm" data-group="mvp">MVP</button>
      </div>

      <div id="overallContainer" style="display:none;">
        <div id="groupView">
          <div class="group-grid">
            <div class="group-block" id="groupA"></div>
            <div class="group-block" id="groupB"></div>
            <div class="group-block" id="groupC"></div>
            <div class="group-block" id="groupD"></div>
          </div>
        </div>
        <div id="mvpArea" class="mvp-area" style="display:none;"></div>
      </div>

      <div class="table-container">
        <table class="leaderboard-table" id="leaderboardTable">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Team</th>
              <th class="hide-mobile">Group</th>
              <th class="hide-mobile">Matches</th>
              <th class="hide-mobile">Finish Pts</th>
              <th class="hide-mobile">Position Pts</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <tr class="coming-soon-row">
              <td colspan="7" style="text-align:center; color: var(--text-muted); font-style: italic;">Data Coming Soon</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="last-updated" id="lastUpdated">
        Last updated: --:--
      </div>
    </div>
  </section>
</Layout>

<style>
  /* ============================================
     EMBER EFFECT FOR LEADING TEAM BANNER
     (EXTRA COMPACT - 60% TOTAL REDUCTION)
     ============================================ */

  /* Leading team banner - 60% smaller than original */
  .leading-team-banner {
    background: linear-gradient(135deg, rgba(255, 69, 0, 0.15) 0%, rgba(139, 0, 0, 0.1) 100%);
    border: 1.5px solid #ff4500; /* Reduced from 2px */
    border-radius: 6px; /* Reduced from 8px */
    padding: 0.75rem 1rem; /* Reduced from 1rem 1.3rem */
    margin-bottom: 1.1rem; /* Reduced from 1.5rem */
    text-align: center;
    box-shadow: 
      0 0 15px rgba(255, 69, 0, 0.4), /* Further reduced glow */
      0 0 30px rgba(255, 140, 0, 0.25),
      inset 0 0 15px rgba(255, 69, 0, 0.12);
    animation: fire-pulse 2s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }

  /* EMBER EFFECT - Floating ember particles (extra small) */
  .leading-team-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      radial-gradient(circle at 15% 85%, rgba(255, 140, 0, 0.4) 0%, transparent 2%), /* Further reduced */
      radial-gradient(circle at 45% 70%, rgba(255, 100, 0, 0.3) 0%, transparent 1.2%),
      radial-gradient(circle at 75% 90%, rgba(255, 200, 0, 0.25) 0%, transparent 1.5%),
      radial-gradient(circle at 25% 60%, rgba(255, 69, 0, 0.5) 0%, transparent 1.2%),
      radial-gradient(circle at 85% 75%, rgba(255, 140, 0, 0.3) 0%, transparent 2%),
      radial-gradient(circle at 55% 95%, rgba(255, 150, 0, 0.4) 0%, transparent 1.2%),
      radial-gradient(circle at 35% 80%, rgba(255, 100, 0, 0.25) 0%, transparent 1.5%),
      radial-gradient(circle at 65% 65%, rgba(255, 180, 0, 0.3) 0%, transparent 1.2%),
      radial-gradient(circle at 90% 85%, rgba(255, 120, 0, 0.4) 0%, transparent 2%),
      radial-gradient(circle at 10% 75%, rgba(255, 160, 0, 0.25) 0%, transparent 1.2%);
    background-size: 100% 100%;
    animation: ember-float 8s ease-in-out infinite;
    z-index: 0;
    opacity: 0.6; /* Reduced from 0.7 */
  }

  /* Animated border with fire colors (extra thin) */
  .leading-team-banner::after {
    content: '';
    position: absolute;
    top: -1.5px; /* Reduced from -2px */
    left: -1.5px;
    right: -1.5px;
    bottom: -1.5px;
    background: linear-gradient(
      45deg,
      #ff4500 0%,
      #ff8c00 25%,
      #ffd700 50%,
      #ff8c00 75%,
      #ff4500 100%
    );
    background-size: 300% 300%;
    animation: fire-border-flow 4s linear infinite;
    z-index: -1;
    border-radius: inherit;
    opacity: 0.6; /* Reduced from 0.7 */
  }

  .leading-team-text {
    font-family: var(--font-heading);
    font-size: 0.975rem; /* Reduced from 1.3rem (25% further reduction) */
    font-weight: 700;
    color: #ff4500;
    text-transform: uppercase;
    letter-spacing: 0.975px; /* Reduced from 1.3px */
    text-shadow: 
      0 0 6px rgba(255, 140, 0, 0.85), /* Further reduced glow */
      0 0 12px rgba(255, 69, 0, 0.6),
      0 0 18px rgba(255, 200, 0, 0.4),
      0 2px 3px rgba(0, 0, 0, 0.35);
    animation: fire-text-flicker 2s ease-in-out infinite;
    margin: 0;
    position: relative;
    z-index: 1;
  }

  /* KEYFRAMES */

  /* Ember floating animation - reduced movement */
  @keyframes ember-float {
    0% {
      transform: translateY(0) translateX(0);
      opacity: 0.6;
    }
    25% {
      transform: translateY(-4px) translateX(1.5px); /* Further reduced */
      opacity: 0.8;
    }
    50% {
      transform: translateY(-8px) translateX(-1px);
      opacity: 0.7;
    }
    75% {
      transform: translateY(-12px) translateX(2px);
      opacity: 0.5;
    }
    100% {
      transform: translateY(-17px) translateX(0); /* Reduced from -23px */
      opacity: 0.3;
    }
  }

  /* Fire pulse animation (further reduced intensity) */
  @keyframes fire-pulse {
    0%, 100% {
      box-shadow: 
        0 0 15px rgba(255, 69, 0, 0.4),
        0 0 30px rgba(255, 140, 0, 0.25),
        inset 0 0 15px rgba(255, 69, 0, 0.12);
    }
    50% {
      box-shadow: 
        0 0 22px rgba(255, 69, 0, 0.6),
        0 0 42px rgba(255, 140, 0, 0.4),
        inset 0 0 22px rgba(255, 69, 0, 0.2);
    }
  }

  /* Border flow animation */
  @keyframes fire-border-flow {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Text flicker animation (further reduced intensity) */
  @keyframes fire-text-flicker {
    0%, 100% {
      text-shadow: 
        0 0 6px rgba(255, 140, 0, 0.85),
        0 0 12px rgba(255, 69, 0, 0.6),
        0 0 18px rgba(255, 200, 0, 0.4),
        0 2px 3px rgba(0, 0, 0, 0.35);
      opacity: 1;
    }
    25% {
      text-shadow: 
        0 0 8px rgba(255, 140, 0, 0.9),
        0 0 14px rgba(255, 69, 0, 0.7),
        0 0 22px rgba(255, 200, 0, 0.5),
        0 2px 3px rgba(0, 0, 0, 0.35);
      opacity: 0.95;
    }
    50% {
      text-shadow: 
        0 0 10px rgba(255, 140, 0, 0.95),
        0 0 18px rgba(255, 69, 0, 0.8),
        0 0 28px rgba(255, 200, 0, 0.6),
        0 2px 3px rgba(0, 0, 0, 0.35);
      opacity: 1;
    }
    75% {
      text-shadow: 
        0 0 7px rgba(255, 140, 0, 0.9),
        0 0 13px rgba(255, 69, 0, 0.65),
        0 0 20px rgba(255, 200, 0, 0.45),
        0 2px 3px rgba(0, 0, 0, 0.35);
      opacity: 0.98;
    }
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .leading-team-text {
      font-size: 0.64rem; /* Reduced from 0.85rem */
      letter-spacing: 0.6px;
    }
    .leading-team-banner {
      padding: 0.49rem 0.75rem; /* Reduced from 0.65rem 1rem */
    }
  }
</style>

<script>
  // Standings page logic
  const filterTabs = document.getElementById('filterTabs');
  const matchFilters = document.getElementById('matchFilters');
  const overallFilters = document.getElementById('overallFilters');

  filterTabs?.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const btn = target.closest('.filter-btn') as HTMLElement;
    if (!btn) return;

    const filter = btn.dataset.filter;

    // Update active state
    filterTabs.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // Show/hide match filters based on selection
    if (filter === 'all') {
      if (matchFilters) matchFilters.style.display = 'none';
      if (overallFilters) overallFilters.style.display = 'flex';
    } else if (filter === 'finals') {
      if (matchFilters) {
        matchFilters.style.display = 'flex';
        // Add extra match button for finals (6 matches)
        const existingBtns = matchFilters.querySelectorAll('.filter-btn');
        if (existingBtns.length === 5) {
          const m6 = document.createElement('button');
          m6.className = 'filter-btn btn-sm';
          m6.dataset.match = '6';
          m6.textContent = 'M6';
          matchFilters.appendChild(m6);
        }
      }
      if (overallFilters) overallFilters.style.display = 'none';
    } else {
      if (matchFilters) {
        matchFilters.style.display = 'flex';
        // Remove M6 button for day matches
        const m6Btn = matchFilters.querySelector('[data-match="6"]');
        if (m6Btn) m6Btn.remove();
      }
      if (overallFilters) overallFilters.style.display = 'none';
    }
  });

  // Match filter clicks
  matchFilters?.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const btn = target.closest('.filter-btn') as HTMLElement;
    if (!btn) return;

    matchFilters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });

  // Group filter clicks
  overallFilters?.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const btn = target.closest('.filter-btn') as HTMLElement;
    if (!btn) return;

    overallFilters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });

  // Render Leading Team Banner
  async function renderLeadingTeamBanner() {
    const container = document.getElementById('leadingTeamBannerContainer');
    if (!container) return;

    try {
      const response = await fetch('/data/standings.json');
      if (!response.ok) return;

      const standings = await response.json();
      if (!standings || standings.length === 0) return;

      // ðŸŽ² RANDOM TEAM SELECTION (For Testing - Remove when tournament starts)
      const randomIndex = Math.floor(Math.random() * standings.length);
      const leadingTeam = standings[randomIndex];

      // For production, use this instead:
      // const leadingTeam = standings.reduce((max: any, team: any) => 
      //   team.totalScore > max.totalScore ? team : max
      // , standings[0]);

      if (!leadingTeam) return;

      // Handle different property names
      const teamNameText = leadingTeam.teamName || leadingTeam.teamname || leadingTeam.name || "Unknown Team";

      // Create and insert banner with ember effect
      const banner = document.createElement('div');
      banner.className = 'leading-team-banner';
      banner.innerHTML = '<h2 class="leading-team-text">' + escapeHtml(teamNameText) + ' is Leading ðŸ”¥</h2>';

      container.innerHTML = '';
      container.appendChild(banner);
    } catch (error) {
      console.log('Could not render leading team banner:', error);
    }
  }

  // Helper function to escape HTML
  function escapeHtml(text: string): string {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Load leading team banner on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', renderLeadingTeamBanner);
  } else {
    renderLeadingTeamBanner();
  }
</script>
