
<script is:inline>
  // ========================================
  // CANVAS FIRE PARTICLE SYSTEM - COMPLETE VERSION
  // ========================================

  class FireParticle {
    constructor(x, y, canvas) {
      this.x = x;
      this.y = y;
      this.canvas = canvas;
      this.size = Math.random() * 8 + 2;
      this.speedY = Math.random() * 3 + 1;
      this.speedX = (Math.random() - 0.5) * 2;
      this.life = 1;
      this.decay = Math.random() * 0.015 + 0.005;
      this.color = this.getFireColor();
    }

    getFireColor() {
      const colors = [
        { r: 255, g: 69, b: 0, a: 1 },
        { r: 255, g: 140, b: 0, a: 1 },
        { r: 255, g: 200, b: 0, a: 1 },
        { r: 255, g: 255, b: 0, a: 0.8 },
      ];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    update() {
      this.y -= this.speedY;
      this.x += this.speedX;
      this.life -= this.decay;
      this.size *= 0.98;
    }

    draw(ctx) {
      if (this.life <= 0) return;

      const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
      gradient.addColorStop(0, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.life * this.color.a})`);
      gradient.addColorStop(0.5, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.life * 0.5})`);
      gradient.addColorStop(1, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, 0)`);

      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }

    isAlive() {
      return this.life > 0;
    }
  }

  class FireEffect {
    constructor(element) {
      this.element = element;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.particles = [];
      this.animationId = null;
      this.setupCanvas();
      this.animate();
      console.log('ðŸ”¥ Fire effect initialized');
    }

    setupCanvas() {
      this.canvas.style.position = 'absolute';
      this.canvas.style.top = '0';
      this.canvas.style.left = '0';
      this.canvas.style.width = '100%';
      this.canvas.style.height = '100%';
      this.canvas.style.pointerEvents = 'none';
      this.canvas.style.zIndex = '1';

      const rect = this.element.getBoundingClientRect();
      this.canvas.width = rect.width;
      this.canvas.height = rect.height;

      this.element.style.position = 'relative';
      this.element.appendChild(this.canvas);

      window.addEventListener('resize', () => this.handleResize());
    }

    handleResize() {
      const rect = this.element.getBoundingClientRect();
      this.canvas.width = rect.width;
      this.canvas.height = rect.height;
    }

    createParticles() {
      const width = this.canvas.width;
      const height = this.canvas.height;

      // Create 3-5 particles per frame for more intense effect
      for (let i = 0; i < 4; i++) {
        const x = Math.random() * width;
        const y = height - 5;
        this.particles.push(new FireParticle(x, y, this.canvas));
      }
    }

    animate() {
      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

      this.createParticles();

      this.particles = this.particles.filter(particle => {
        particle.update();
        particle.draw(this.ctx);
        return particle.isAlive();
      });

      this.animationId = requestAnimationFrame(() => this.animate());
    }

    destroy() {
      if (this.animationId) {
        cancelAnimationFrame(this.animationId);
      }
    }
  }

  // ========================================
  // BANNER CREATION WITH FIRE EFFECT
  // ========================================

  let fireEffectInstance = null;

  function createLeadingTeamBanner() {
    console.log('ðŸš€ Creating leading team banner with fire effect...');

    const container = document.getElementById('leadingTeamBannerContainer');
    if (!container) {
      console.error('âŒ Container not found');
      return;
    }

    fetch('/data/standings.json')
      .then(r => r.json())
      .then(data => {
        const leadingTeam = data.reduce((max, team) => {
          const maxScore = max.stats?.overall?.total_pts || 0;
          const teamScore = team.stats?.overall?.total_pts || 0;
          return teamScore > maxScore ? team : max;
        }, data[0]);

        if (!leadingTeam) return;

        // Create banner
        const banner = document.createElement('div');
        banner.className = 'leading-team-banner';
        banner.id = 'leadingBanner';

        const heading = document.createElement('h2');
        heading.className = 'leading-team-text';
        heading.textContent = leadingTeam.team_name + ' is Leading ðŸ”¥';

        banner.appendChild(heading);
        container.innerHTML = '';
        container.appendChild(banner);

        console.log('âœ… Banner created:', leadingTeam.team_name);

        // Initialize fire effect after a short delay to ensure DOM is ready
        setTimeout(() => {
          const bannerElement = document.getElementById('leadingBanner');
          if (bannerElement && !bannerElement.dataset.fireInitialized) {
            try {
              fireEffectInstance = new FireEffect(bannerElement);
              bannerElement.dataset.fireInitialized = 'true';
              console.log('âœ… Fire effect started successfully');
            } catch (err) {
              console.error('âŒ Fire effect failed:', err);
            }
          }
        }, 200);
      })
      .catch(err => {
        console.error('âŒ Failed to load standings:', err);
      });
  }

  // Initialize when page loads
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', createLeadingTeamBanner);
  } else {
    createLeadingTeamBanner();
  }

  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    if (fireEffectInstance) {
      fireEffectInstance.destroy();
    }
  });
</script>
