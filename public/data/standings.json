---
// Import the JSON data
import allTeamsData from '../data/teams.json';

// --- SORTING LOGIC ---
// We filter for active teams and then sort them by:
// 1. Total Points (Highest to Lowest)
// 2. Total Kills (Highest to Lowest) - as tiebreaker
const leaderboardData = allTeamsData
  .filter((team) => team.stats.overall.matches_played > 0 || team.stats.overall.total_pts > 0)
  .sort((a, b) => {
    // Primary Sort: Total Points
    if (b.stats.overall.total_pts !== a.stats.overall.total_pts) {
      return b.stats.overall.total_pts - a.stats.overall.total_pts;
    }
    // Secondary Sort: Total Kills (Finish Points)
    return b.stats.overall.finish_pts - a.stats.overall.finish_pts;
  });

// Define the matches to display
const matches = ['M1', 'M2', 'M3', 'M4'];
---

<div class="leaderboard-container">
  <div class="header">
    <h2 class="title">üèÜ Official Tournament Standings (Final)</h2>
    <p class="subtitle">(Matches 1-4 Combined)</p>
  </div>

  <div class="table-responsive">
    <table class="leaderboard-table">
      <thead>
        <tr>
          <th class="rank-header">Rank</th>
          <th class="team-header">Official Team Name</th>
          {matches.map((match) => (
            <th class="match-header">{match} Pts</th>
          ))}
          <th class="points-header">Total Points</th>
          <th class="kills-header">Total Kills</th>
        </tr>
      </thead>
      <tbody>
        {leaderboardData.map((team, index) => (
          <tr class={`rank-row rank-${index + 1}`}>
            <td class="rank-cell">
              <span class="rank-number">#{index + 1}</span>
            </td>
            <td class="team-cell">
              {/* Optional: Add Logo if available */}
              {/* <img src={`/logos/${team.team_logo}.png`} alt={team.team_name} class="team-logo" /> */}
              <span class="team-name">{team.team_name}</span>
            </td>
            {matches.map((matchKey) => (
              <td class="match-cell">
                {team.stats.day1[matchKey]?.total || 0}
              </td>
            ))}
            <td class="total-cell">{team.stats.overall.total_pts}</td>
            <td class="kills-cell">{team.stats.overall.finish_pts}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</div>

<style>
  /* --- STYLES --- */
  .leaderboard-container {
    background-color: #121212; /* Dark background */
    color: #e0e0e0;
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    max-width: 1200px;
    margin: 0 auto;
  }

  .header {
    margin-bottom: 25px;
    text-align: left;
    border-bottom: 1px solid #333;
    padding-bottom: 15px;
  }

  .title {
    margin: 0;
    font-size: 1.5rem;
    color: #ffffff;
    font-weight: 700;
  }

  .subtitle {
    margin: 5px 0 0;
    font-size: 0.9rem;
    color: #aaaaaa;
  }

  /* Table Wrapper for mobile scrolling */
  .table-responsive {
    overflow-x: auto;
  }

  .leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 700px; /* Ensures table doesn't squash on mobile */
  }

  /* Headers */
  th {
    background-color: #1e1e1e;
    padding: 15px 10px;
    text-align: center;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #888;
    border-bottom: 2px solid #333;
  }

  th.team-header {
    text-align: left;
    padding-left: 20px;
  }

  th.points-header {
    color: #fff;
    font-weight: 800;
  }

  /* Cells */
  td {
    padding: 12px 10px;
    text-align: center;
    border-bottom: 1px solid #2a2a2a;
    font-size: 0.95rem;
  }

  /* Team Name Column */
  .team-cell {
    text-align: left;
    padding-left: 20px;
    font-weight: 600;
    color: #fff;
    text-transform: uppercase;
  }

  /* Match Columns */
  .match-cell {
    color: #ccc;
  }

  /* Total Points Column */
  .total-cell {
    font-weight: 800;
    font-size: 1.1rem;
    color: #4ade80; /* Green accent for points */
  }

  /* Kills Column */
  .kills-cell {
    font-weight: 600;
    color: #f87171; /* Red accent for kills */
  }

  /* Top 3 Ranks Highlighting */
  .rank-1 .rank-number { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  .rank-2 .rank-number { color: #c0c0c0; }
  .rank-3 .rank-number { color: #cd7f32; }

  /* Hover Effect */
  tbody tr:hover {
    background-color: #2a2a2a;
  }
</style>
